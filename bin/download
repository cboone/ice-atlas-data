#!/usr/bin/env bash

set -e

declare -r start_time="$(date -u '+%Y-%m-%d %H:%M:%S')"
echo "[download] Started at $start_time"

declare -r dir="$(pwd)"

for region in "$@"; do
  echo "[download] Downloading $region"

  docker run \
    --rm \
    -e JAVA_TOOL_OPTIONS="-Xmx32g -XX:MaxHeapFreeRatio=40" \
    -v "$dir/data":/data \
    ghcr.io/onthegomap/planetiler:latest \
    --area="$region" \
    --download \
    --only-download \
    --download-threads=10 \
    --download-chunk-size-mb=1000 \
    --fetch-wikidata \
    --nodemap-type=sparsearray \
    --storage=ram \
    --transportation_name_size_for_shield \
    --transportation_name_limit_merge \
    --boundary-osm-only \
    --max-point-buffer=4 \
    --building_merge_z13=false \
    --maxzoom=15 \
    --render_maxzoom=15
done
