#!/usr/bin/env bash

set -e

declare -r start_time="$(date -u '+%Y-%m-%d %H:%M:%S')"
echo "Started at $start_time"

declare -r dir="$(pwd)"

echo "Converting merged.osm.pbf"

set -x
docker run \
  --rm \
  -e JAVA_TOOL_OPTIONS="-Xmx32g -XX:MaxHeapFreeRatio=40" \
  -v "$dir/data":/data \
  ghcr.io/onthegomap/planetiler:latest \
  --osm_path=/data/merged.osm.pbf \
  --output=/data/merged.pmtiles \
  --nodemap-type=sparsearray \
  --storage=ram \
  --transportation_name_size_for_shield \
  --transportation_name_limit_merge \
  --boundary-osm-only \
  --building_merge_z13=false \
  --max-point-buffer=4 \
  --maxzoom=15 \
  --render_maxzoom=15
